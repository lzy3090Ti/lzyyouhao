<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>秘密指令检测</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">

  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#165DFF',
            secondary: '#36D399',
            accent: '#FF6B35',
            dark: '#1E293B',
            light: '#F8FAFC'
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
        }
      }
    }
  </script>

  <style type="text/tailwindcss">
    @layer utilities {
      .animate-pulse-slow {
        animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
      }

      .backdrop-blur {
        backdrop-filter: blur(8px);
      }
    }
  </style>
</head>

<body class="min-h-screen bg-gradient-to-br from-dark to-slate-800 flex items-center justify-center p-4 font-sans overflow-hidden">
  <div id="particles" class="fixed inset-0 z-0 opacity-30"></div>

  <div class="relative z-10 w-full max-w-xl">
    <div id="progress-container" class="relative mb-8 overflow-hidden rounded-full h-4 bg-slate-700/50">
      <div id="progress-bar" class="h-full bg-gradient-to-r from-primary to-secondary w-0 transition-all duration-300 ease-out"></div>
    </div>
  </div>

  <script>
    const KONAMI_CODE = [
      'ArrowUp', 'ArrowUp',
      'ArrowDown', 'ArrowDown',
      'ArrowLeft', 'ArrowRight',
      'ArrowLeft', 'ArrowRight',
      'KeyB', 'KeyA', 'KeyB', 'KeyA'
    ];
    let userSequence = [];
    let shakeDetection = {
      isShaking: false,
      shakeStart: null,
      lastX: null,
      lastY: null,
      lastZ: null,
      threshold: 15,
      requiredDuration: 5000,
      currentShakeTime: 0
    };
    const progressBar = document.getElementById('progress-bar');

    function updateProgress() {
      const progress = (userSequence.length / KONAMI_CODE.length) * 100;
      progressBar.style.width = `${progress}%`;
    }

    function handleKeyDown(e) {
      if (!KONAMI_CODE.includes(e.code)) return;
      userSequence.push(e.code);
      if (userSequence[userSequence.length - 1]!== KONAMI_CODE[userSequence.length - 1]) {
        userSequence = [];
      }
      updateProgress();
      if (userSequence.length === KONAMI_CODE.length) {
        completeAction();
      }
    }

    function handleDeviceMotion(e) {
      const acceleration = e.accelerationIncludingGravity;
      if (shakeDetection.lastX === null) {
        shakeDetection.lastX = acceleration.x;
        shakeDetection.lastY = acceleration.y;
        shakeDetection.lastZ = acceleration.z;
        return;
      }
      const deltaX = Math.abs(acceleration.x - shakeDetection.lastX);
      const deltaY = Math.abs(acceleration.y - shakeDetection.lastY);
      const deltaZ = Math.abs(acceleration.z - shakeDetection.lastZ);
      if (deltaX > shakeDetection.threshold || deltaY > shakeDetection.threshold || deltaZ > shakeDetection.threshold) {
        if (!shakeDetection.isShaking) {
          shakeDetection.isShaking = true;
          shakeDetection.shakeStart = new Date().getTime();
        } else {
          const now = new Date().getTime();
          shakeDetection.currentShakeTime = now - shakeDetection.shakeStart;
          const progress = (shakeDetection.currentShakeTime / shakeDetection.requiredDuration) * 100;
          progressBar.style.width = `${progress}%`;
          if (shakeDetection.currentShakeTime >= shakeDetection.requiredDuration) {
            completeAction();
          }
        }
      } else if (shakeDetection.isShaking) {
        const now = new Date().getTime();
        if (now - shakeDetection.shakeStart - shakeDetection.currentShakeTime > 1000) {
          shakeDetection.isShaking = false;
          progressBar.style.width = '0%';
        }
      }
      shakeDetection.lastX = acceleration.x;
      shakeDetection.lastY = acceleration.y;
      shakeDetection.lastZ = acceleration.z;
    }

    function completeAction() {
      window.removeEventListener('keydown', handleKeyDown);
      window.removeEventListener('devicemotion', handleDeviceMotion);
      progressBar.style.width = '100%';
      progressBar.className = 'h-full bg-secondary transition-all duration-500 ease-out';
      setTimeout(() => {
        window.location.href = 'zzh/index.html';
      }, 3000);
    }

    function createParticles() {
      const particles = document.getElementById('particles');
      const count = 50;
      for (let i = 0; i < count; i++) {
        const particle = document.createElement('div');
        const size = Math.random() * 5 + 1;
        particle.className = 'absolute rounded-full bg-primary/20';
        particle.style.width = `${size}px`;
        particle.style.height = `${size}px`;
        particle.style.left = `${Math.random() * 100}%`;
        particle.style.top = `${Math.random() * 100}%`;
        particle.style.animation = `float ${Math.random() * 10 + 10}s linear infinite`;
        particle.style.animationDelay = `${Math.random() * 5}s`;
        particles.appendChild(particle);
      }
    }

    const style = document.createElement('style');
    style.textContent = `
      @keyframes float {
        0% {
          transform: translateY(0) translateX(0);
          opacity: 0.3;
        }
        50% {
          transform: translateY(-50px) translateX(20px);
          opacity: 0.6;
        }
        100% {
          transform: translateY(0) translateX(0);
          opacity: 0.3;
        }
      }
    `;
    document.head.appendChild(style);

    window.addEventListener('DOMContentLoaded', () => {
      createParticles();
      window.addEventListener('keydown', handleKeyDown);
      if (window.DeviceMotionEvent) {
        if (DeviceMotionEvent.requestPermission) {
          DeviceMotionEvent.requestPermission()
           .then(permission => {
              if (permission === 'granted') {
                window.addEventListener('devicemotion', handleDeviceMotion);
              }
            });
        } else {
          window.addEventListener('devicemotion', handleDeviceMotion);
        }
      }
    });
  </script>
</body>

</html>